<div class="card shadow-sm">
  <div class="card-header bg-success text-white d-flex align-items-center">
    <i class="bi bi-plus-square me-2"></i>
    <strong>{{title}}</strong>
  </div>

  <div class="card-body">
    <form id="formNew" class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Título</label>
        <input name="title" type="text" class="form-control" required />
      </div>

      <div class="col-md-3">
        <label class="form-label">Código</label>
        <input name="code" type="text" class="form-control" required />
      </div>

      <div class="col-md-3">
        <label class="form-label">Categoría</label>
        <input name="category" type="text" class="form-control" />
      </div>

      <div class="col-md-3">
        <label class="form-label">Precio</label>
        <input name="price" type="number" step="0.01" min="0" class="form-control" required />
      </div>

      <div class="col-md-3">
        <label class="form-label">Stock</label>
        <input name="stock" type="number" min="0" class="form-control" required />
      </div>

      <div class="col-md-3">
        <label class="form-label d-block">Estado</label>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="status" name="status" checked>
          <label class="form-check-label" for="status">Activo</label>
        </div>
      </div>

      <div class="col-12">
        <label class="form-label">Descripción</label>
        <textarea name="description" class="form-control" rows="3"></textarea>
      </div>

      <div class="col-12">
        <label class="form-label">Thumbnails (URLs separadas por coma)</label>
        <input name="thumbnails" type="text" class="form-control" placeholder="/images/a.jpg, /images/b.jpg" />
      </div>

      <div class="col-12 d-flex gap-2">
        <button class="btn btn-success" type="submit">
          <i class="bi bi-check2-circle"></i> Guardar
        </button>
        <a href="/realtimeproducts" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Volver
      </a>
      </div>

      <div id="msgNew" class="col-12 d-none">
        <div class="alert" role="alert"></div>
      </div>
    </form>
  </div>
</div>

<script>
  (function(){
    const form = document.getElementById('formNew');
    const box = document.getElementById('msgNew');
    const alert = box.querySelector('.alert');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      data.price = Number(data.price);
      data.stock = Number(data.stock);
      data.status = document.getElementById('status').checked;
      data.thumbnails = (data.thumbnails || '').split(',').map(s => s.trim()).filter(Boolean);

      try {
        const resp = await fetch('/api/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);

          box.classList.remove('d-none');
          alert.className = 'alert alert-success';
          alert.textContent = 'Producto creado con éxito.';
          setTimeout(() => (window.location.href = '/realtimeproducts'), 500);

      } catch (err) {
        box.classList.remove('d-none');
        alert.className = 'alert alert-danger';
        alert.textContent = 'No se pudo crear el producto.';
      }
    });
  })();
</script>
